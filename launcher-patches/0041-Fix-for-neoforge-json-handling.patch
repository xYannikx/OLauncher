From 2f7285be9dafd693f9976303bddfc3a4353fe420 Mon Sep 17 00:00:00 2001
From: RagedMeteor1837 <148640131+RagedMeteor1837@users.noreply.github.com>
Date: Mon, 9 Feb 2026 21:11:59 +0000
Subject: [PATCH] Fix for neoforge json handling


diff --git a/src/main/java/com/mojang/launcher/updater/DateTypeAdapter.java b/src/main/java/com/mojang/launcher/updater/DateTypeAdapter.java
index 2a2c319..a575e26 100644
--- a/src/main/java/com/mojang/launcher/updater/DateTypeAdapter.java
+++ b/src/main/java/com/mojang/launcher/updater/DateTypeAdapter.java
@@ -18,10 +18,12 @@ import java.util.Locale;
 public class DateTypeAdapter implements JsonSerializer<Date>, JsonDeserializer<Date> {
     private final DateFormat enUsFormat;
     private final DateFormat iso8601Format;
+    private final DateFormat iso8601FormatWithMillis;
 
     public DateTypeAdapter() {
         this.enUsFormat = DateFormat.getDateTimeInstance(2, 2, Locale.US);
         this.iso8601Format = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ");
+        this.iso8601FormatWithMillis = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ");
     }
 
     public Date deserialize(JsonElement var1, Type var2, JsonDeserializationContext var3) throws JsonParseException {
@@ -57,7 +59,35 @@ public class DateTypeAdapter implements JsonSerializer<Date>, JsonDeserializer<D
                         var3 = var3.substring(0, 22) + var3.substring(23);
                         var10000 = this.iso8601Format.parse(var3);
                     } catch (Exception var5) {
-                        throw new JsonSyntaxException("Invalid date: " + var1, var5);
+                        try {
+                            // olauncher neoforge fix: handle nanosecond precision dates
+                            String var8 = var1;
+                            if (var8.contains("T") && !var8.contains("+") && !var8.contains("Z")) {
+                                int tIndex = var8.indexOf('T');
+                                int dotIndex = var8.indexOf('.', tIndex);
+                                
+                                if (dotIndex > 0) {
+                                    StringBuilder sb = new StringBuilder(var8.substring(0, dotIndex + 1));
+                                    int digitsAdded = 0;
+                                    for (int i = dotIndex + 1; i < var8.length() && digitsAdded < 3; i++) {
+                                        char c = var8.charAt(i);
+                                        if (Character.isDigit(c)) {
+                                            sb.append(c);
+                                            digitsAdded++;
+                                        } else {
+                                            break;
+                                        }
+                                    }
+                                    sb.append("+0000");
+                                    var8 = sb.toString();
+                                } else {
+                                    var8 = var1 + "+0000";
+                                }
+                            }
+                            var10000 = this.iso8601FormatWithMillis.parse(var8);
+                        } catch (Exception var4) {
+                            throw new JsonSyntaxException("Invalid date: " + var1, var4);
+                        }
                     }
 
                     return var10000;
-- 
2.53.0.windows.1

